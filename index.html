<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MotiWord</title>
    <link
      rel="stylesheet"
      href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css"
    />
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Roboto", sans-serif;
        margin: 0;
        padding: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }
      .container {
        max-width: 100%;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }
      .editor {
        width: 100%;
        height: calc(100% - 64px); /* Ajustar a la altura del menú */
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 16px;
        resize: none;
        overflow-y: auto;
        box-sizing: border-box;
      }
      .editor[contenteditable="true"] {
        outline: none;
      }
      .toolbar {
        margin-bottom: 10px;
      }
      .icon-btn {
        cursor: pointer;
        padding: 10px;
        font-size: 24px;
        vertical-align: middle;
      }
      .mdl-button--save {
        width: 100%;
        margin-top: 10px;
      }
      /* Estilos para el menú hamburguesa */
      .mdl-layout__drawer {
        z-index: 100;
      }
      .mdl-layout-title {
        padding: 16px;
      }
      .mdl-navigation__link {
        padding: 8px;
      }
      .mdl-layout__content {
        height: calc(100vh - 64px); /* Resta el alto del header */
      }

      /* Media queries para hacer responsive el diseño */
      @media (max-width: 600px) {
        /* Editor en pantallas pequeñas al 100% */
        .editor {
          font-size: 14px;
          height: calc(100% - 64px); /* Ajustar en dispositivos móviles */
        }

        /* Ajuste para que el contenedor ocupe toda la pantalla */
        .mdl-layout__content {
          padding: 0;
          margin: 0;
        }
      }

      @media (min-width: 600px) {
        .editor {
          height: calc(
            100% - 120px
          ); /* En pantallas más grandes el editor será un poco más pequeño */
        }
      }
    </style>
  </head>
  <body>
    <!-- Layout principal con Drawer para el menú -->
    <div
      class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer mdl-layout--fixed-header"
    >
      <!-- Encabezado del menú -->
      <header class="mdl-layout__header">
        <div class="mdl-layout__header-row">
          <span class="mdl-layout-title">MotiWord</span>
        </div>
      </header>

      <!-- Menú de hamburguesa -->
      <div class="mdl-layout__drawer">
        <span class="mdl-layout-title">Opciones</span>
        <nav class="mdl-navigation">
          <a class="mdl-navigation__link" href="#" id="open-docx"
            >Abrir Archivo DOCX</a
          >
          <a class="mdl-navigation__link" href="#" id="save-pdf"
            >Guardar como PDF</a
          >
        </nav>
      </div>

      <!-- Contenido principal -->
      <main class="mdl-layout__content">
        <div class="container">
          <!-- Barra de herramientas con iconos -->
          <div class="toolbar">
            <span id="bold-btn" class="material-icons icon-btn"
              >format_bold</span
            >
            <span id="italic-btn" class="material-icons icon-btn"
              >format_italic</span
            >
          </div>

          <!-- Editor de texto enriquecido -->
          <div id="text-editor" class="editor" contenteditable="true">
            Escribe tu texto aquí...
          </div>
        </div>
      </main>
    </div>

    <!-- Input para seleccionar archivos DOCX -->
    <input type="file" id="file-input" style="display: none" accept=".docx" />

    <script>
      // Botones de iconos para aplicar negrita y cursiva
      document
        .getElementById("bold-btn")
        .addEventListener("click", function () {
          document.execCommand("bold");
        });

      document
        .getElementById("italic-btn")
        .addEventListener("click", function () {
          document.execCommand("italic");
        });

      // Abrir archivo DOCX
      document
        .getElementById("open-docx")
        .addEventListener("click", function () {
          document.getElementById("file-input").click(); // Abrir el explorador de archivos
        });

      document
        .getElementById("file-input")
        .addEventListener("change", function (event) {
          var reader = new FileReader();
          reader.onload = function (event) {
            var arrayBuffer = reader.result;
            mammoth
              .extractRawText({ arrayBuffer: arrayBuffer })
              .then(function (result) {
                document.getElementById("text-editor").innerHTML = result.value; // Mostrar el contenido DOCX en el editor
              })
              .catch(function (err) {
                console.log(err);
              });
          };
          reader.readAsArrayBuffer(event.target.files[0]);
        });

      // Guardar contenido como PDF
      document
        .getElementById("save-pdf")
        .addEventListener("click", function () {
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();

          // Obtener el contenido del editor (solo texto)
          const content = document.getElementById("text-editor").innerHTML;

          // Crear un elemento temporal para extraer solo el texto sin etiquetas HTML
          const tempElement = document.createElement("div");
          tempElement.innerHTML = content;
          const plainText = tempElement.innerText;

          // Agregar el texto plano al PDF (sin formato)
          doc.text(plainText, 10, 10);

          // Guardar el PDF con el nombre "documento.pdf"
          doc.save("documento.pdf");
        });
    </script>
  </body>
</html>
